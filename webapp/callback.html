<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>[sidecar] code generated</title>
    <link rel='stylesheet' href='styles.css'>
    <style>
    .error {
      color: red;
    }
    .valid {
      color: green;
    }
    </style>
  </head>
  <body>
    <div class='container'>
    <h1>コードが発行されました</h1>
      <div class='box'>
        以下のコードをボタンを押してコピーして LINE で Sidecar BOT に送ってください
        <div id='code'></div>
        <!-- <button id='copy_button' onclick="copyToClipboard()" disabled>Copy Text</button> -->
        <div class="button019">
        	<a href="#" id='copy_button' onclick="copyToClipboard()" disabled>タップしてコピーする</a>
        </div>
      </div>
    </div>

    <script>
      // URLのクエリパラメータをパースする
      const urlParams = new URLSearchParams(window.location.search);

      // "id"パラメータの値を取得する
      const code = urlParams.get('code');

      // IDで指定された<div>要素を取得する
      const divElement = document.getElementById('code');

      // <div>要素の中の文字列を取得する
      //const divText = divElement.innerHTML;

      // 置換を行う
      //const replacedText = divText.replace("置換前の文字列", "置換後の文字列");

      // <div>要素の中の文字列を置換された文字列に更新する
      console.log(code);
      if (code != null && code.length > 0) {
        divElement.innerHTML = "<p class='valid' id='valid_code'>code : " + code;
        document.getElementById('copy_button').disabled = false;
      } else {
        divElement.innerHTML = "<p class='error'>コードが取得できません</p>";
      }

      function copyToClipboard() {
        var elm = document.getElementById('valid_code');
        if (elm !== null) {
          var text = document.getElementById('valid_code').innerText;
          navigator.clipboard.writeText(text)
            .then(function() {
              alert('コードをコピーしました');
            })
            .catch(function() {
              alert('Failed to copy text to clipboard!');
            });
        } else {
          alert('[ERROR] no valid code found');
        }
      }
    </script>
  </body>
  
</html>
